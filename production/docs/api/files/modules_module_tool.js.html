<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>modules/module_tool.js - Educational Visualization</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://epe.marine.rutgers.edu/ev/img/ev_logo.png" title="Educational Visualization"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/EduVis.Configuration.html">EduVis.Configuration</a></li>
            
                <li><a href="../classes/EduVis.Controls.html">EduVis.Controls</a></li>
            
                <li><a href="../classes/EduVis.formats.html">EduVis.formats</a></li>
            
                <li><a href="../classes/resource.html">resource</a></li>
            
                <li><a href="../classes/Tool.html">Tool</a></li>
            
                <li><a href="../classes/Utility.html">Utility</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Resource.html">Resource</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: modules/module_tool.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">

/*  *  *  *  *  *  *  *
*
* EduVis.tool
*
* tool initialization, loading, and information access
*
*/

/**
* The tool module...
*
* @class Tool
* @constructor
*/

(function (eduVis) {

    &quot;use strict&quot;;

    var _tools_version = &quot;0.03&quot;,
        _tools_path = &quot;tools/&quot;, // full url can be used
        _tools_resource_path = &quot;&quot;,

/** Load the tool. Show the loading screen. Request the tool javascript via jQuery getScript
* 
* @method _tool_load
* @param {Object} obj_tool tool creation object
* @return {String} The reversed string 
*/

    _tool_load = function(obj_tool) {

        var tools = typeof eduVis.tools === &quot;object&quot; ? eduVis.tools : {};

        obj_tool.instance_id = typeof obj_tool.instance_id === &quot;undefined&quot; ? &quot;default&quot; : obj_tool.instance_id;
        obj_tool.dom_target = obj_tool.name + &quot;_&quot; + obj_tool.instance_id;


        console.log(&quot;----Tool target --&gt; &quot;, obj_tool.dom_target);

        var dom_target = $(&quot;#&quot; + obj_tool.dom_target);

        // creat tool container at dom_target
        if(dom_target.length == 0){

            $(&#x27;body&#x27;).append(
                $(&quot;&lt;div&gt;&lt;/div&gt;&quot;)
                    .addClass(&quot;tool-container&quot;)
                    .append(&quot;&lt;div&gt;&lt;/div&gt;&quot;)
                        .attr(&quot;id&quot;, obj_tool.dom_target)
            )
        }
        else{


        }

        // create loading div

        var loading_div = $(&quot;&lt;div&gt;&lt;/div&gt;&quot;)
            .addClass(&quot;loading&quot;)
            .attr(&quot;id&quot;, obj_tool.dom_target + &quot;_loading&quot;)
            .append(
                $(&quot;&lt;div&gt;&lt;/div&gt;&quot;)
                    .html(
                        &quot;&lt;h1&gt;Educational Visualization&lt;/h1&gt;&quot;+
                        &quot;&lt;h2&gt;&quot;+ obj_tool.name+&quot;&lt;/h2&gt;&quot;
                    )
            )
            .append(
                $(&#x27;&lt;img src=&quot;resources/img/loading_small.gif&quot; /&gt;&#x27;)
            )
            .appendTo(
                $(&quot;#&quot;+obj_tool.dom_target)
            )

        // Ajax request for tool javascript source. on success, queue up the tool resources. If an instance id is provided, call Configuraiton.request_instance.
        $.getScript( _tools_path + obj_tool.name + &quot;/&quot; + obj_tool.name + &#x27;.js&#x27;, function() {
            
            console.log(&quot;....tool notify....&quot;)
            EduVis.tool.notify( {&quot;name&quot;:obj_tool.name,&quot;tool_load&quot;:&quot;complete&quot;});

            console.log(&quot;....tool queue....&quot;);
            EduVis.resource.queue( EduVis.tool.tools[obj_tool.name].resources, obj_tool.name);

            console.log(&quot;....tool instance....&quot;);
            
            //if(typeof obj_tool.instance_id !== &quot;undefined&quot;){
            if(obj_tool.instance_id !== &quot;default&quot;){
                
                console.log(&quot;....tool instance request....&quot;);
                EduVis.configuration.request_instance(obj_tool);

                // note: tool initialized in request_instance function.
            }else{

                console.log(&quot;....tool instance init default....&quot;);
                EduVis.tool.init( obj_tool );
            }

        });
    
    },

/** placeholder for Tool Loading when/if we want to isolate all tool loading functions
* 
* @method _tool_load
* @param {Object} _obj_tool tool creation object
* @return {null} 
*/

    _tool_loading = function(_obj_tool){
    },

/** function trigged when the tool loading is complete
* 
* @method _tool_loading_complete
* @param {Object} _obj_tool tool creation object
* @return {null} 
*/
    _tool_loading_complete = function(_obj_tool){

        //fade out loading div for a specific tool instance
        var div_loading = _obj_tool.dom_target + &quot;_loading&quot;;
        
        $(&#x27;#&#x27; + div_loading).fadeOut();
    },

/** notifcations for a specic tool. currently just console logging the entire object. * could be developed to bring pop up notificaiton or alert notification to tools
* 
* @method _tool_notify
* @param {Object} _obj_notify a notify object. 
* @return {null} 
*/    
    _tool_notify = function ( _obj_notify ){

        console.log(&quot;tool notify&quot;, _obj_notify);
        
    },

/** check to see if all the dependencies of a tool are loaded 
* 
* @method _tool_is_ready
* @param {Object} _obj_tool a tool object. 
* @return {Boolean} 
*/  

    _tool_is_ready = function( _obj_tool ){

        console.log(&quot;Tool Obj&quot;, _obj_tool);

        // test if all resources have been loaded for the tool
        var r = _tool_find_resources(_obj_tool),
            i = 0,
            scripts = r.scripts,
            stylesheets = r.stylesheets,
            scripts_length = scripts.length,
            stylesheets_length = stylesheets.length;

            console.log(&quot;RRRRR&quot;, r);

        for (;i&lt;scripts_length; i++) {

            if(typeof EduVis.resource.loaded[scripts[i]] !== &quot;object&quot;){

                console.log(&quot;returned FALSE! -&gt; &quot;, scripts[i])
                return false;
            }
        }

        i=0;
        for (;i&lt;stylesheets_length; i++) {

            if(typeof EduVis.resource.loaded[stylesheets[i]] !== &quot;object&quot;){

                console.log(&quot;returned FALSE! -&gt; &quot;, stylesheets[i])

                return false;
            }
        }

        //_tool_loading_complete(_obj_tool);
        return true;

    },

/** check to see if all the dependencies of a tool are loaded 
* 
* @method _tool_find_resources
* @param {Object} _obj_tool a tool object. 
* @return {Object} tool_resources 
*/  
    _tool_find_resources = function(_obj_tool){

        var resources = _obj_tool.resources,
            scr_ext = resources.scripts_external,
            scr_ext_length = scr_ext.length,

            scr_local = resources.scripts_local,
            scr_local_length = scr_local.length,

            sty_ext = resources.stylesheets_external,
            sty_ext_length = sty_ext.length,

            sty_local = resources.stylesheets_local,
            sty_local_length = sty_local.length,

            scripts = [],
            stylesheets = [],
            i = 0, j=0, k=0, l=0,
            _tool_resources = {
                &quot;scripts&quot; : [],
                &quot;stylesheets&quot; : []
            },
            scripts = _tool_resources.scripts,
            stylesheets = _tool_resources.stylesheets,

            script_count = 0,
            style_count = 0;

        for(; i&lt;scr_ext_length; i++){

            scripts[script_count] = scr_ext[i].name;
            script_count+=1;
        }

        for(; j&lt;scr_local_length; j++){
            scripts[script_count] = scr_local[j].name;
            script_count+=1;
        }

        for(; k&lt;sty_ext_length; k++){

            stylesheets[style_count] = sty_ext[k].name;
            style_count+=1;
        }

        for(; l&lt;sty_local_length; l++){
            stylesheets[style_count] = sty_local[l].name;
            style_count+=1;
        }

        return _tool_resources;
    },

/** initialize the tool. override configuration with appropriate instance configuration
* 
* @method _tool_init
* @param {Object} _obj_tool a tool object. 
* @return {null}
*/ 
    _tool_init = function(obj_tool){

        var name = obj_tool.name,
            Tool = EduVis.tool.tools[name];

            Tool.objDef = obj_tool;

        console.log(&quot;--&gt; Tool&quot;, Tool);
        console.log(&quot;--&gt; Tool Name&quot;, name, &quot;tool object&quot;, obj_tool);

        Tool.dom_target = obj_tool.dom_target;
        
        if(typeof Tool === &quot;object&quot;){

            if( _tool_is_ready(Tool) ){

                var instance_id = obj_tool.instance_id;

                // not a very elegant solution to dealing with multiple instances with the same instances configuration
                if(typeof EduVis.tool.instances[name] === &quot;object&quot; ){

                    if(typeof EduVis.tool.instances[name][instance_id] === &quot;object&quot;){

                        instance_id = instance_id + &quot;_&quot; + ($(EduVis.tool.instances[name]).length + 1);

                        obj_tool.instance_id = instance_id;

                        EduVis.tool.instances[name][instance_id] = Tool;

                    }
                    else{
                        EduVis.tool.instances[name][instance_id] = Tool;
                    }
                }
                else{
                
                    EduVis.tool.instances[name] = {};
                    EduVis.tool.instances[name][instance_id] = Tool;
                }

                // update instance configuration 
                $.extend(EduVis.tool.instances[name][instance_id].configuration, obj_tool.instance_config);

                console.log(&quot; .... Instance! ....&quot;);
                console.log(EduVis.tool.instances[name][instance_id]);
                console.log(&quot;Initializing &quot; + name + &quot; with instance_id &quot; + instance_id + &quot; and instance:&quot;, obj_tool.instance_config);

                // initialize tool instance
                EduVis.tool.instances[name][instance_id].init();
            }
            else{
                
                console.log(&quot;Tool Not ready to load. Still waiting on some dependencies..&quot;);

                setTimeout((function(){

                    // rescursive delayed call.. 1 seconds.. to tool initiation
                    if(EduVis.utility.hault){
                        console.log(&quot;..EduVis Haulted..&quot;);
                    }else{

                        _tool_init(obj_tool);
                    }

                }),1000);
            }
        }
        else{
            alert(&quot;..no tool object..&quot;)
        }
    },

/** output the controls of a tool for custom configuration
* 
* @method _tool_customize
* @param {String} tool_name the name of the tool to customize
* @param {String} instance_id the instance ID of the tool
* @param {String} target_div the div where the output will be placed
* @return {null}
*/
    _tool_customize = function( tool_name, instance_id, target_div ){

        var tool = EduVis.tool.instances[tool_name][instance_id],
            divToolEditor,
            divControls
            el_btn;

            divToolEditor = $(&quot;&lt;div&gt;&lt;/div&gt;&quot;)
                .addClass(&quot;ToolEditor&quot;);

            divControls = $(&quot;&lt;div&gt;&lt;/div&gt;&quot;)
                .addClass(&quot;tool-control&quot;)

            console.log(&quot;...TOOL CUSTOMIZE....&quot;)
            console.log(&quot;tool-&gt;&quot;,tool);

        // create a div and write out all controls for editing a specific tool configuration file
        // the tool does not need to be loaded as an instance, but must be loaded into object


        // a button will be clicked and it will refresh the tool.. 
        // div with controls will be refreshed on tool updates or when &quot;refresh&quot; is clicked.

        // test if tool has any controls
        if(typeof tool.controls !== &quot;object&quot;){

            divToolEditor.append(&quot;&lt;p&gt;This tool does not have an configurable properties..&lt;/p&gt;&quot;)

        }
        else{

            // Add each control to the specified div
            $.each(tool.controls, function (index, control) {
                
                divControls.append(
                    EduVis.controls.create(tool,&quot;config-&quot;+index, control)
                    //instance.evtool.toolControl(instance,&quot;config-&quot;+index, control)
                );

            });

            divToolEditor.append(divControls);

             // Now draw an update button that will redraw the instance
            el_btn = $(&#x27;&lt;button type=&quot;button&quot;&gt;Redraw Visualization&lt;/button&gt;&#x27;)
                .addClass(&quot;btn pull-right&quot;)
                .click( function () { _tool_redraw(tool_name, instance_id); })
                .appendTo(divToolEditor);
        }
                
        // todo: add instance 

        $(&quot;#&quot; + target_div)
            .append(divToolEditor);

    },

/** returns the tool version
* 
* @method _tool_version
* @param {String} tool_name the name of the tool to customize
* @param {String} instance_id the instance ID of the tool
* @param {String} target_div the div where the output will be placed
* @return {null}
*/
    _tool_version = function(){
        return _tool_version;
    },

/** returns a bare tool object structure
* 
* @method _tool_base_template
* @return {Object} _object a bare tools object structure
*/    
    // todo: add constructor to tool base
    _tool_base_template = function(){

        return {

            &quot;name&quot; : &quot;_undefined_tool_name_&quot;,
            &quot;description&quot; : &quot;__undefined_description_&quot;,
            &quot;url&quot; : &quot;helpfile does not exist&quot;,
            &quot;instance&quot;:&quot;&quot;, 

            &quot;version&quot; : &quot;&quot;,
            &quot;authors&quot; : [],        
            &quot;resources&quot; : {

                &quot;scripts_local&quot; : [],
                &quot;scripts_external&quot; : [],
                &quot;stylesheets_local&quot; : [],
                &quot;stylesheets_external&quot; : [],
                &quot;datasets&quot; : [] 
            },

            &quot;configuration&quot; : {},
            &quot;instance_configuration&quot; : {},
            &quot;controls&quot; : {},
            &quot;data&quot; : {},
            &quot;div_target&quot; : &quot;__undefined_target__&quot;,
            &quot;tools&quot; : {},
            &quot;instances&quot; : {}

        };
    };

    eduVis.tool = {
        resource_path : _tools_resource_path,
        load : _tool_load,
        init : _tool_init,
        version : _tool_version,
        notify : _tool_notify,
        is_ready : _tool_is_ready,
        find_resources : _tool_find_resources,
        template : _tool_base_template,
        customize : _tool_customize,
        load_complete : _tool_loading_complete,
        tools : {},
        instances : {}
    };

}(EduVis));

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
